# Logs

A log is a record of events that occur within an organization's systems and networks.

* Useful to security analysts during incident investigation since they record details of what, where, and when an event occurred on the network.
* Log analysis is the process of examining logs to identify events of interest.
* SIEM tools help process large log volumes from multiple data sources in real-time.
* Software known as **log forwarders** collect logs from various sources and automatically forward them to a centralized log repository for storage.

| **Type of Log**         | **Log Data Source**                   |
| ----------------------- | ------------------------------------- |
| **Network Logs**        | Proxies, routers, switches, firewalls |
| **System Logs**         | Operating systems                     |
| **Application Logs**    | Software applications                 |
| **Security Logs**       | Security tools like IDS or IPS        |
| **Authentication Logs** | Login attempts                        |

## **Network Logs**

* **Source Devices**: Proxies, routers, switches, and firewalls generate network logs.
* **Information Recorded**: Logs include details about source and destination of network traffic, along with timestamp.
* **Detection of Suspicious Activity**: Network logs help in identifying unauthorized access attempts and denial-of-service attacks.

## **System Logs**

System logs are generated by operating systems. These logs contain information about the operation of the operating system, including events such as system startup, shutdown, and software installations. System logs can be used to troubleshoot problems with the operating system and to identify security breaches.

## **Application Logs**

Application logs are generated by software applications. These logs contain information about the operation of the application, including events such as user logins, errors, and crashes. Application logs can be used to troubleshoot problems with the application and to identify security vulnerabilities.

## **Security Logs**

Security logs are generated by security tools such as IDS or IPS. These logs contain information about security events, such as intrusion attempts, malware infections, and unauthorized access attempts. Security logs can be used to identify security breaches and to track the activities of attackers.

## **Authentication Logs**

Authentication logs record login attempts. These logs contain information about the user who attempted to log in, the time and date of the attempt, and the success or failure of the attempt. Authentication logs can be used to identify unauthorized access attempts and to track the activities of attackers.

## Firewall logs:

record of attempted or established connections for incoming traffic from the internet. It also includes outbound requests to the internet from within the network.

## Server logs:

a record of events related to services such as websites, emails, or file shares. It includes actions such as login, password, and username requests.

```c
**Login Event [2022/11/16 05:45:15.892673] auth_performer.cc:470 User1 Authenticated successfully from device1 (192.168.1.2)**
```

## **Log retention**

* **Regulatory Compliance**:
  * Different industries have specific regulations dictating the retention of logs.
* **Public Sector (FISMA)**:
  * Federal Information Security Modernization Act mandates certain log retention periods for government agencies.
* **Healthcare (HIPAA)**:
  * Health Insurance Portability and Accountability Act requires healthcare organizations to retain logs to protect patient data.
* **Financial Services**:
  * Payment Card Industry Data Security Standard (PCI DSS), Gramm-Leach-Bliley Act (GLBA), and Sarbanes-Oxley Act (SOX) necessitate log retention for financial data protection.
* **Log Management Policy**:
  * Organizations adjust log retention practices to comply with regulatory requirements.

## **Log protection**

* **Centralized Log Storage**: Logs are stored on a dedicated server rather than individual local machines.
* **Enhanced Integrity**: Centralized storage minimizes the risk of logs being tampered with or modified by malicious actors.
* **Reduced Accessibility for Attackers**: With logs stored centrally, attackers face an additional barrier in accessing and modifying log data.
* **Facilitates Monitoring**: Security teams can more effectively monitor and analyze logs when they are stored centrally, enhancing overall security posture.
* **Streamlined Management**: Centralized storage simplifies log management processes, such as retention policies and access control.

Some commonly used log formats include:

*   **Syslog**

    [RFC 5424: The Syslog Protocol](https://www.rfc-editor.org/rfc/rfc5424)

    A protocol and log format that contains a header, followed by structured-data, and a message.

    * **Header:** Contains data fields like Timestamp, the Hostname, the Application name, and the Message ID.
    * **Structured-data:** Contains additional data information in key-value pairs.
    * **Message:** Contains the detailed log message about the event.

    Syslog is a standard for logging and transmitting data. It can be used to refer to any of its three different capabilities:

    1. **Protocol**: The syslog protocol is used to transport logs to a centralized log server for log management. It uses port 514 for plaintext logs and port 6514 for encrypted logs.
    2. **Service**: The syslog service acts as a log forwarding service that consolidates logs from multiple sources into a single location. The service works by receiving and then forwarding any syslog log entries to a remote server.
    3. **Log format**: The syslog log format is one of the most commonly used log formats that you will be focusing on. It is the native logging format used in Unix® systems. It consists of three components: a header, structured-data, and a message.

    ### Syslog log example

    Here is an example of a syslog entry that contains all three components: a header, followed by structured-data, and a message:

    ```c
    **<236>1 2022-03-21T01:11:11.003Z virtual.machine.com evntslog - ID01 [user@32473 iut="1" eventSource="Application" eventID="9999"] 
    This is a log entry!**
    ```

    #### **Header**

    The header contains details like the timestamp; the hostname, which is the name of the machine that sends the log; the application name; and the message ID.

    * **Timestamp**: The timestamp in this example is **2022-03-21T01:11:11.003Z**, where **2022-03-21** is the date in YYYY-MM-DD format. **T** is used to separate the date and the time. **01:11:11.003** is the 24-hour format of the time and includes the number of milliseconds **003**. **Z** indicates the timezone, which is Coordinated Universal Time (UTC).
    * **Hostname**: **virtual.machine.com**
    * **Application**: **evntslog**
    * **Message** **ID**: **ID01**

    #### **Structured-data**

    The structured-data portion of the log entry contains additional logging information. This information is enclosed in square brackets and structured in key-value pairs. Here, there are three keys with corresponding values: **\[user@32473 iut="1" eventSource="Application" eventID="9999"]**.

    #### **Message**

    The message contains a detailed log message about the event. Here, the message is **This is a log entry!**.

    #### **Priority (PRI)**

    The priority (PRI) field indicates the urgency of the logged event and is contained with angle brackets. In this example, the priority value is **<236>** . Generally, the lower the priority level, the more urgent the event is.

    **Note**: Syslog headers can be combined with JSON, and XML formats. Custom log formats also exist.

    ***
*   **JSON**

    A text-based format designed to be easy to read and write. It uses key-value pairs to structure data.

    JSON logs are typically more concise and easier to read than XML logs. However, XML logs can be more easily parsed by machines.

    ```
    {
      "name": "John Doe",
      "age": 30,
      "occupation": "Software Engineer"
    }
    ```

    JavaScript Object Notation (JSON) is a file format that is used to store and transmit data. JSON is known for being lightweight and easy to read and write. It is used for transmitting data in web technologies and is also commonly used in cloud environments. JSON syntax is derived from JavaScript syntax. If you are familiar with JavaScript, you might recognize that JSON contains components from JavaScript including:

    * Key-value pairs
    * Commas
    * Double quotes
    * Curly brackets
    * Square brackets

    #### **Key-value pairs**

    A **key-value** **pair** is a set of data that represents two linked items: a key and its corresponding value. A key-value pair consists of a key followed by a colon, and then followed by a value. An example of a key-value pair is  **"Alert": "Malware"**.

    **Note**: For readability, it is recommended that key-value pairs contain a space before or after the colon that separates the key and value.

    #### **Commas**

    Commas are used to separate data. For example: **"Alert": "Malware", "Alert code": 1090, "severity": 10**.

    #### **Double quotes**

    Double quotes are used to enclose _text_ data, which is also known as a string, for example:  **"Alert": "Malware"**. Data that contains numbers \*is not \*\*\*\*\*enclosed in quotes, like this: **"Alert code": 1090**.

    #### **Curly brackets**

    Curly brackets enclose an **object**, which is a data type that stores data in a comma-separated list of key-value pairs. Objects are often used to describe multiple properties for a given key. JSON log entries start and end with a curly bracket. In this example, **User** is the object that contains multiple properties:

    **"User" {  "id": "1234",  "name": "user", "role": "engineer" }**

    #### **Square brackets**

    Square brackets are used to enclose an **array**, which is a data type that stores data in a comma-separated ordered list. Arrays are useful when you want to store data as an ordered collection, for example: **\["Administrators", "Users", "Engineering"]**.

    ***
*   **XML**

    A language and format used for storing and transmitting data. It uses tags and other keys to structure data.

    *

    ```
    <person>
      <name>John Doe</name>
      <age>30</age>
      <occupation>Software Engineer</occupation>
    </person>
    ```

    XML (eXtensible Markup Language) is a language and a format used for storing and transmitting data. XML is a native file format used in Windows systems. XML syntax uses the following:

    * Tags
    * Elements
    * Attributes

    #### **Tags**

    XML uses tags to store and identify data. Tags are pairs that must contain a start tag and an end tag. The start tag encloses data with angle brackets, for example ,  whereas the end of a tag encloses data with angle brackets and a forward slash like this: .

    #### **Elements**

    XML elements include _both_ the data contained inside of a tag and the tags itself. All XML entries must contain at least one root element. Root elements contain other elements that sit underneath them, known as child elements.

    Here is an example:

    **4688 5**

    In this example, is the root element and contains two child elements and . There is data contained in each respective child element.

    #### **Attributes**

    XML elements can also contain attributes. Attributes are used to provide additional information about elements. Attributes are included as the second part of the tag itself and must always be quoted using either single or double quotes.

    For example:

    **S-2-3-11-160321 JSMITH ADCOMP 0x1cf1c12 0x1404**

    In the first line for this example, the tag is  and it uses the attribute  **Name='SubjectUserSid'** to describe the data enclosed in the tag **S-2-3-11-160321**.

    ***
*   **CSV**

    A format that uses separators like commas to separate data values.

    CSV (Comma Separated Value) uses commas to separate data values. In CSV logs, the position of the data corresponds to its field name, but the field names themselves might not be included in the log. It’s critical to understand what fields the source device (like an IPS, firewall, scanner, etc.) is including in the log.

    Here is an example:

    ```c
    **2009-11-24T21:27:09.534255,ALERT,192.168.2.7, 1041,x.x.250.50,80,TCP,ALLOWED,1:2001999:9,"ET MALWARE BTGrab.com Spyware Downloading Ads",1**
    ```

    ***
*   CEF

    **(Common Event Format)**

    **Common Event Format (CEF)** is a log format that uses key-value pairs to structure data and identify fields and their corresponding values. The CEF syntax is defined as containing the following fields:

    **CEF:Version|Device Vendor|Device Product|Device Version|Signature ID|Name|Severity|Extension**

    Fields are all separated with a pipe character **|**. However, anything in the **Extension** part of the CEF log entry must be written in a key-value format. Syslog is a common method used to transport logs like CEF. When Syslog is used a timestamp and hostname will be prepended to the CEF message. Here is an example of a CEF log entry that details malicious activity relating to a worm infection:

    ```c
    **Sep 29 08:26:10 host CEF:1|Security|threatmanager|1.0|100|worm successfully stopped|10|src=10.0.0.2 dst=2.1.2.2 spt=1232**
    ```

    Here is a breakdown of the fields:

    * **Syslog Timestamp**: **Sep 29 08:26:10**
    * **Syslog Hostname**: **host**
    * **Version**: \*\*\*\* **CEF:1**
    * **Device Vendor**: **Security**
    * **Device Product**: **threatmanager**
    * **Device Version**: **1.0**
    * **Signature ID**: **100**
    * **Name**: **worm successfully stopped**
    * **Severity**: **10**
    * **Extension**: This field contains data written as key-value pairs. There are two IP addresses, **src=10.0.0.2** and **dst=2.1.2.2**, and a source port number **spt=1232**. Extensions are not required and are optional to add.

    This log entry contains details about a **Security** application called **threatmanager** that **successfully stopped a worm** from spreading from the internal network at **10.0.0.2** to the external network **2.1.2.2** through the port **1232**. A high severity level of **10** is reported.

    **Note**: Extensions and syslog prefix are optional to add to a CEF log.

    ***

| Feature         | JSON                    | XML                    |
| --------------- | ----------------------- | ---------------------- |
| Data structure  | Key-value pairs         | Tags and attributes    |
| Verbosity       | Concise                 | Verbose                |
| Readability     | Easy to read            | More difficult to read |
| Machine parsing | More difficult to parse | Easier to parse        |

*   Adv and Disadvantages **of using CSV as a log format:**

    #### **Advantages :**

    * **Simplicity:** CSV is a very simple format that is easy to read and write. It is also easy to parse, which makes it a good choice for applications that need to process large amounts of log data quickly.
    * **Flexibility:** CSV is a very flexible format that can be used to store a wide variety of data types. This makes it a good choice for applications that need to log data from multiple sources or that need to log data in a custom format.
    * **Portability:** CSV is a portable format that can be read and written by a variety of applications and tools. This makes it a good choice for applications that need to share log data with other systems or that need to be able to access log data from multiple locations.

    **Disadvantages:**

    * **Verbosity:** CSV logs can be very verbose, especially if they contain a lot of data. This can make them difficult to read and understand.
    * **Lack of structure:** CSV logs do not have a formal structure, which can make it difficult to parse and process them. This can be a problem for applications that need to extract specific information from log data.
    * **Lack of support for complex data types:** CSV logs do not support complex data types, such as arrays and objects. This can make it difficult to log data from applications that use these data types.

    **Advantages of using Syslog as a log format:**

    * **Standardization:** Syslog is a standardized format that is supported by a wide variety of applications and devices. This makes it a good choice for applications that need to interoperate with other systems or that need to be able to access log data from multiple sources.
    * **Structure:** Syslog logs have a well-defined structure, which makes them easy to parse and process. This can be a benefit for applications that need to extract specific information from log data.
    * **Support for complex data types:** Syslog supports complex data types, such as arrays and objects. This makes it a good choice for applications that need to log data from applications that use these data types.

    **Disadvantages of using Syslog as a log format:**

    * **Complexity:** Syslog is a more complex format than CSV, which can make it more difficult to read and write. It can also be more difficult to parse and process Syslog logs, especially if they contain a lot of data.
    * **Verbosity:** Syslog logs can be very verbose, especially if they contain a lot of data. This can make them difficult to read and understand.
    * **Lack of flexibility:** Syslog is a less flexible format than CSV, which can make it difficult to log data from multiple sources or to log data in a custom format.

    **Advantages of using JSON as a log format:**

    * **Simplicity:** JSON is a simple format that is easy to read and write. It is also easy to parse, which makes it a good choice for applications that need to process large amounts of log data quickly.
    * **Flexibility:** JSON is a very flexible format that can be used to store a wide variety of data types. This makes it a good choice for applications that need to log data from multiple sources or that need to log data in a custom format.
    * **Portability:** JSON is a portable format that can be read and written by a variety of applications and tools. This makes it a good choice for applications that need to share log data with other systems or that need to be able to access log data from multiple locations.

    **Disadvantages of using JSON as a log format:**

    * **Verbosity:** JSON logs can be very verbose, especially if they contain a lot of data. This can make them difficult to read and understand.
    * **Lack of standardization:** JSON is not a standardized format, which can make it difficult to interoperate with other systems or to access log data from multiple sources.
    * **Lack of support for complex data types:** JSON does not support complex data types, such as arrays and objects. This can make it difficult to log data from applications that use these data types.

    ***

Generation Log formats:

[generatedata.com](https://generatedata.com/)
